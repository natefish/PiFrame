<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/PiFrameMain.css">
</head>

<body>
    <div id="bgFill">
    </div>
    <div id="photoDisplay">
        <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <a href="#">Settings</a>
            <a href="#">About</a>
            <a href="#">Donate</a>
        </div>

        <div id="main">
            <span style="cursor:pointer;" onclick="openNav()" id="myMenuBtn">&#9776;</span>
        </div>
    </div>

    <script>
        var xhttp = new XMLHttpRequest();

        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                stageSlides(this.responseXML);
            }
        };
        xhttp.open("GET", "images.xml", true);
        xhttp.send();
        
        function preloadNextImage(imgIndex, imgNodes){
            imgIndex++;
            if (imgIndex >= imgNodes.length) { imgIndex = 0 }

            imgURL = imgNodes[imgIndex].childNodes[0].nodeValue;

            //Pre-load the image
            var nextImg = new Image();
            nextImg.src = imgURL;
        }

        function stageSlides(xmlDoc) {
            var imgNodes = xmlDoc.getElementsByTagName("img");
            var imgIndex = imgNodes.length;
            var imgURL = "";

            setInterval(function () {
                imgIndex++;
                if (imgIndex >= imgNodes.length) { imgIndex = 0 }

                imgURL = imgNodes[imgIndex].childNodes[0].nodeValue;

                document.getElementById("photoDisplay").style.backgroundImage = "url('" + imgURL + "')";
                document.getElementById("bgFill").style.backgroundImage = "url('" + imgURL + "')";
                
                preloadNextImage(imgIndex, imgNodes);
            }, 30000);
        }

        function openNav() {
            document.getElementById("mySidenav").style.width = "200px";
            document.getElementById("main").style.marginLeft = "200px";
            document.getElementById("myMenuBtn").style.fontSize = "0px";
            document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
        }

        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
            document.getElementById("myMenuBtn").style.fontSize = "30px";
            document.body.style.backgroundColor = "black";
        }
    </script>

</body>

</html>
